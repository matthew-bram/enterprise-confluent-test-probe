# Rosetta Vault Mapping Configuration
#
# This file defines how vault JSON is mapped to VaultCredentials fields.
# Supports YAML or JSON format with JSONPath expressions and transformations.
#
# Target Model: VaultCredentials
#   - topic: Kafka topic name
#   - role: Producer or consumer role (e.g., "PRODUCER", "CONSUMER")
#   - clientId: OAuth client ID for Kafka authentication
#   - clientSecret: OAuth client secret (may be base64-encoded in vault)
#
# Note: jaasConfig is NOT mapped here - it's constructed by the framework
#       from these credentials + OAuth configuration in application.conf

mappings:
  # Map Kafka topic name
  - targetField: topic
    sourcePath: $.kafka.topics[0].name
    # Example vault JSON:
    # {
    #   "kafka": {
    #     "topics": [{"name": "orders.events"}]
    #   }
    # }

  # Map role with uppercase transformation
  - targetField: role
    sourcePath: $.kafka.credentials.role
    transformations:
      - type: toUpper
    # Example vault JSON:
    # {
    #   "kafka": {
    #     "credentials": {
    #       "role": "producer"  # Will be transformed to "PRODUCER"
    #     }
    #   }
    # }

  # Map OAuth client ID
  - targetField: clientId
    sourcePath: $.kafka.credentials.oauth.client_id
    # Example vault JSON:
    # {
    #   "kafka": {
    #     "credentials": {
    #       "oauth": {
    #         "client_id": "kafka-producer-123"
    #       }
    #     }
    #   }
    # }

  # Map OAuth client secret with base64 decoding
  - targetField: clientSecret
    sourcePath: $.kafka.credentials.oauth.client_secret
    transformations:
      - type: base64Decode
    # Example vault JSON:
    # {
    #   "kafka": {
    #     "credentials": {
    #       "oauth": {
    #         "client_secret": "bXktc2VjcmV0LWtleQ=="  # base64 encoded
    #       }
    #     }
    #   }
    # }
    # After transformation: "my-secret-key"


# ========================================
# Advanced Examples
# ========================================

# Example: Deep nesting (6 levels)
# - targetField: topic
#   sourcePath: $.vault.production.kafka.clusters.primary.topics[0].name

# Example: Array wildcard for multiple topics
# - targetField: topics
#   sourcePath: $.kafka.topics[*].name

# Example: Conditional default value
# - targetField: role
#   sourcePath: $.kafka.role
#   defaultValue: "PRODUCER"
#   transformations:
#     - type: toUpper

# Example: Multiple transformations (chained)
# - targetField: clientId
#   sourcePath: $.oauth.raw_client_id
#   transformations:
#     - type: base64Decode
#     - type: prefix
#       value: "kafka-"

# Example: Concatenate multiple fields
# - targetField: clientId
#   sourcePath: $.oauth.prefix
#   transformations:
#     - type: concat
#       separator: "-"
#       # Note: Concat transformation extracts multiple paths
#       # Implementation varies by use case

# ========================================
# Real-World Vault Structure Examples
# ========================================

# AWS Secrets Manager format:
# {
#   "kafka": {
#     "topics": [{"name": "orders.events", "type": "producer"}],
#     "credentials": {
#       "role": "producer",
#       "oauth": {
#         "client_id": "kafka-producer-123",
#         "client_secret": "bXktc2VjcmV0LWtleQ=="
#       }
#     }
#   }
# }

# HashiCorp Vault format (deep nesting):
# {
#   "data": {
#     "metadata": {
#       "topic": "orders.events"
#     },
#     "credentials": {
#       "producer": {
#         "role": "PRODUCER",
#         "clientId": "kafka-producer-123",
#         "clientSecret": "bXktc2VjcmV0LWtleQ=="
#       }
#     }
#   }
# }
# Mapping for HashiCorp:
# - targetField: topic
#   sourcePath: $.data.metadata.topic
# - targetField: role
#   sourcePath: $.data.credentials.producer.role
# - targetField: clientId
#   sourcePath: $.data.credentials.producer.clientId
# - targetField: clientSecret
#   sourcePath: $.data.credentials.producer.clientSecret
#   transformations:
#     - type: base64Decode

# Azure Key Vault format (flat structure):
# {
#   "topic-name": "orders.events",
#   "kafka-role": "producer",
#   "oauth-client-id": "kafka-producer-123",
#   "oauth-client-secret-base64": "bXktc2VjcmV0LWtleQ=="
# }
# Mapping for Azure:
# - targetField: topic
#   sourcePath: $["topic-name"]
# - targetField: role
#   sourcePath: $["kafka-role"]
#   transformations:
#     - type: toUpper
# - targetField: clientId
#   sourcePath: $["oauth-client-id"]
# - targetField: clientSecret
#   sourcePath: $["oauth-client-secret-base64"]
#   transformations:
#     - type: base64Decode
