# Test-Probe Services Configuration
# =================================
#
# This file contains default configuration for the test-probe-services module.
# These settings can be overridden in application.conf.

test-probe.services {

  # Vault Service Configuration
  # ----------------------------
  # Vault service fetches security credentials (OAuth client IDs, secrets) from
  # cloud provider functions or local storage.
  #
  # Supported Providers:
  # - "local"  : jimfs-based in-memory vault (testing/spike)
  # - "aws"    : AWS Lambda-based vault (production)
  # - "azure"  : Azure Functions-based vault (production)
  # - "gcp"    : GCP Cloud Functions-based vault (production)

  vault {
    # Active vault provider
    provider = "local"
    rosetta-mapping-path = ""

    # Local Vault Configuration
    # --------------------------
    # Used when provider = "local"
    # jimfs-based in-memory vault for testing/spike environments
    local {
      # List of fields to extract from vault response
      # topic and role are provided by TopicDirective, only credentials need to be fetched
      required-fields = ["clientId", "clientSecret"]
    }

    # AWS Lambda Vault Configuration
    # -------------------------------
    # Used when provider = "aws"
    aws {
      # AWS Lambda function ARN for vault queries
      # Example: "arn:aws:lambda:us-east-1:123456789012:function:vault-function"
      lambda-arn = ""

      # AWS region for Lambda invocation
      region = "us-east-1"

      # Timeout for Lambda invocation
      timeout = 10s

      # Maximum retry attempts for transient failures (rate limiting, timeouts)
      retry-attempts = 3

      # List of fields to extract from vault response
      # topic and role are provided by TopicDirective, only credentials need to be fetched
      required-fields = ["clientId", "clientSecret"]
    }

    # Azure Functions Vault Configuration
    # ------------------------------------
    # Used when provider = "azure"
    azure {
      # Azure Functions HTTP trigger URL
      # Example: "https://company-vault.azurewebsites.net/api/vault-credentials"
      function-url = ""

      # Azure function key for authentication
      function-key = ""

      # Timeout for function invocation
      timeout = 10s

      # Maximum retry attempts for transient failures
      retry-attempts = 3

      # List of fields to extract from vault response
      # topic and role are provided by TopicDirective, only credentials need to be fetched
      required-fields = ["clientId", "clientSecret"]
    }

    # GCP Cloud Functions Vault Configuration
    # ----------------------------------------
    # Used when provider = "gcp"
    gcp {
      # GCP Cloud Functions HTTP trigger URL
      # Example: "https://us-central1-project-id.cloudfunctions.net/vault-credentials"
      function-url = ""

      # Optional: Path to GCP service account JSON key file for authentication
      # If not provided, uses Application Default Credentials (ADC)
      # service-account-key = "/path/to/service-account-key.json"

      # Timeout for function invocation
      timeout = 10s

      # Maximum retry attempts for transient failures
      retry-attempts = 3

      # List of fields to extract from vault response
      # topic and role are provided by TopicDirective, only credentials need to be fetched
      required-fields = ["clientId", "clientSecret"]
    }

    # OAuth Configuration
    # -------------------
    # Used for constructing JAAS configs for Kafka SASL/OAUTHBEARER authentication
    oauth {
      # OAuth2 token endpoint URL
      token-endpoint = "https://oauth.company.com/token"

      # OAuth2 scope for Kafka authentication
      scope = "kafka.producer kafka.consumer"
    }

    # Rosetta Mapping Configuration
    # ------------------------------
    # Optional: Path to Rosetta mapping file for parsing CSP-specific vault responses
    # Rosetta maps cloud-provider-specific JSON structures to standard VaultCredentials format
    #
    # Example: "classpath:rosetta/vault-credentials-mapping.yaml"
    # rosetta-mapping-path = "rosetta/vault-mapping.yaml"
  }

  # Block Storage Service Configuration
  # ------------------------------------
  # Block storage service fetches test artifacts (feature files, topic directives)
  # from cloud storage and uploads evidence files after test execution.
  #
  # Supported Providers:
  # - "aws"    : AWS S3 (production)
  # - "azure"  : Azure Blob Storage (production)
  # - "gcp"    : Google Cloud Storage (production)

  block-storage {
    # Active block storage provider
    provider = "aws"

    # Topic directive file name (YAML file containing Kafka topic configurations)
    topic-directive-file-name = "topic-directive.yaml"

    # AWS S3 Configuration
    # --------------------
    # Used when provider = "aws"
    aws {
      # AWS region for S3 bucket access
      region = "us-east-1"

      # Maximum retry attempts for transient S3 failures
      retry-attempts = 3

      # Timeout for S3 operations
      timeout = "30s"
    }

    # Azure Blob Storage Configuration
    # ---------------------------------
    # Used when provider = "azure"
    azure {
      # Azure storage account name
      # Example: "companytestprobe"
      storage-account-name = ""

      # Azure storage account key or SAS token
      storage-account-key = ""

      # Timeout for blob storage operations
      timeout = "30s"

      # Maximum retry attempts for transient failures
      retry-attempts = 3
    }

    # GCP Cloud Storage Configuration
    # --------------------------------
    # Used when provider = "gcp"
    gcp {
      # GCP project ID
      # Example: "company-test-probe"
      project-id = ""

      # Optional: Path to GCP service account JSON key file
      # If not provided, uses Application Default Credentials (ADC)
      service-account-key = ""

      # Timeout for Cloud Storage operations
      timeout = "30s"

      # Maximum retry attempts for transient failures
      retry-attempts = 3
    }
  }
}
